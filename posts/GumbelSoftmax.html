<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Scott H. Hawley">
<meta name="dcterms.date" content="2024-12-24">
<meta name="description" content="A Gentle Introduction to Gumbel-Softmax - Work in Progress!">

<title>Scott H. Hawley - [Draft] Learning Discrete Variables Continuously via Gumbel-Softmax</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
details > summary {
    color: #00966f;   /* the greenish tinge that appears in my blog */
    cursor: pointer; /* lil triangle thingy */
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Scott H. Hawley - [Draft] Learning Discrete Variables Continuously via Gumbel-Softmax">
<meta property="og:description" content="A Gentle Introduction to Gumbel-Softmax - Work in Progress!">
<meta property="og:image" content="https://drscotthawley.github.io/blog/posts/images/flow_gaussian_to_spiral.png">
<meta property="og:site-name" content="Scott H. Hawley">
<meta property="og:image:height" content="298">
<meta property="og:image:width" content="640">
<meta name="twitter:title" content="Scott H. Hawley - [Draft] Learning Discrete Variables Continuously via Gumbel-Softmax">
<meta name="twitter:description" content="A Gentle Introduction to Gumbel-Softmax - Work in Progress!">
<meta name="twitter:image" content="https://drscotthawley.github.io/blog/posts/images/flow_gaussian_to_spiral.png">
<meta name="twitter:image-height" content="298">
<meta name="twitter:image-width" content="640">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Scott H. Hawley</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/drscotthawley" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/drscotthawley" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">[Draft] Learning Discrete Variables Continuously via Gumbel-Softmax</h1>
                  <div>
        <div class="description">
          A Gentle Introduction to Gumbel-Softmax - Work in Progress!
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">discrete</div>
                <div class="quarto-category">continuous</div>
                <div class="quarto-category">tricks</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Scott H. Hawley </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 24, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#first-up-mess-around" id="toc-first-up-mess-around" class="nav-link" data-scroll-target="#first-up-mess-around"><span class="header-section-number">1.1</span> First Up: Mess around</a></li>
  <li><a href="#the-problem-discrete-vs.-continuous" id="toc-the-problem-discrete-vs.-continuous" class="nav-link" data-scroll-target="#the-problem-discrete-vs.-continuous"><span class="header-section-number">1.2</span> 1. The Problem: Discrete vs.&nbsp;Continuous</a></li>
  <li><a href="#the-challenge-of-discrete-outputs" id="toc-the-challenge-of-discrete-outputs" class="nav-link" data-scroll-target="#the-challenge-of-discrete-outputs"><span class="header-section-number">1.3</span> 2. The Challenge of Discrete Outputs</a></li>
  <li><a href="#the-gumbel-max-trick" id="toc-the-gumbel-max-trick" class="nav-link" data-scroll-target="#the-gumbel-max-trick"><span class="header-section-number">1.4</span> 3. The Gumbel-Max Trick</a></li>
  <li><a href="#enter-gumbel-softmax" id="toc-enter-gumbel-softmax" class="nav-link" data-scroll-target="#enter-gumbel-softmax"><span class="header-section-number">1.5</span> 4. Enter Gumbel-Softmax</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">2</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div style="text-align: right;">
<p><a href="https://colab.research.google.com/github/drscotthawley/blog/blob/main/extra/GumbelSoftmax.ipynb"> <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"> </a></p>
</div>
<p><em>This is a draft post that may never see the light of day. If you are seeing it on the main blog page, then that’s a mistake</em></p>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Imagine you’re training a neural network to make a choice between three ice cream flavors: vanilla, chocolate, or strawberry. The network needs to output a single discrete choice, but we know neural networks work best with continuous variables they can adjust gradually. This is the core challenge we’ll tackle: how can we let neural networks learn to make discrete choices while training with continuous variables?</p>
<section id="first-up-mess-around" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="first-up-mess-around"><span class="header-section-number">1.1</span> First Up: Mess around</h2>
<p>In a previous post we had an <a href="https://drscotthawley.github.io/blog/posts/Transformers1-Attention.html#sec-softmax-fun">interactive softmax visualization</a>. Here we reproduce this by imagining the probability of choosing 3 different classes of ice cream: vanilla, chocolate, and strawberry, visualized using a softmax function with certaint temperature. By varying the “temperature” slider, you can stretch the dominant choice to make the predictions “sharper”. In the limit where the temperature goes to zero, we get the <code>argmax</code> function.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>html_content <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;div style="background: white; padding: 20px; font-family: Arial;"&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;div style="margin-bottom: 20px; color: black;"&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;label&gt;Temperature: &lt;span id="temp-value"&gt;1.0&lt;/span&gt;&lt;/label&gt;&lt;br&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;input type="range" id="temp-slider" min="0.01" max="2.0" step="0.01" value="1.0" style="width: 500px"&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;canvas id="gumbel-viz" width="500" height="300" style="border:1px solid #000;"&gt;&lt;/canvas&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;div style="color: black; margin-top: 10px;"&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style="display: inline-block; margin-right: 20px;"&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;span style="display: inline-block; width: 20px; height: 20px; background: #FFE5CC; margin-right: 5px;"&gt;&lt;/span&gt;Vanilla</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style="display: inline-block; margin-right: 20px;"&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;span style="display: inline-block; width: 20px; height: 20px; background: #8B4513; margin-right: 5px;"&gt;&lt;/span&gt;Chocolate</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style="display: inline-block;"&gt;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;span style="display: inline-block; width: 20px; height: 20px; background: #FFB6C1; margin-right: 5px;"&gt;&lt;/span&gt;Strawberry</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/div&gt;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;script&gt;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="st">(function() {</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="st">    const canvas = document.getElementById('gumbel-viz');</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="st">    const ctx = canvas.getContext('2d');</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="st">    // Store fixed Gumbel noise samples</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="st">    const NUM_SAMPLES = 5;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="st">    const NUM_CLASSES = 3;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="st">    const fixedGumbelNoise = Array(NUM_SAMPLES).fill().map(() =&gt; </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="st">        Array(NUM_CLASSES).fill().map(() =&gt; -Math.log(-Math.log(Math.random())))</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="st">    );</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="st">    const LOGITS = [2.0, 1.0, 0.0];  // Fixed logits (bias towards vanilla)</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="st">    function softmax(logits, temperature) {</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="st">        const expLogits = logits.map(x =&gt; Math.exp(x / temperature));</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="st">        const sum = expLogits.reduce((a, b) =&gt; a + b, 0);</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="st">        return expLogits.map(x =&gt; x / sum);</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="st">    function generateSample(gumbelNoise, temperature) {</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="st">        const noisyLogits = LOGITS.map((l, i) =&gt; l + gumbelNoise[i]);</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="st">        return softmax(noisyLogits, temperature);</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="st">    function drawSamples(temperature) {</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.clearRect(0, 0, canvas.width, canvas.height);</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="st">        // Draw axes</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.strokeStyle = 'black';</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.lineWidth = 1;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.beginPath();</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.moveTo(40, 20);</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.lineTo(40, canvas.height - 40);</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.lineTo(canvas.width - 20, canvas.height - 40);</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.stroke();</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="st">        // Y-axis labels</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.fillStyle = 'black';</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.font = '12px Arial';</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.textAlign = 'right';</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.fillText('1.0', 35, 25);</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.fillText('0.5', 35, canvas.height/2);</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.fillText('0.0', 35, canvas.height - 35);</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="st">        // Generate and draw samples using fixed noise</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="st">        for(let i = 0; i &lt; NUM_SAMPLES; i++) {</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="st">            const sample = generateSample(fixedGumbelNoise[i], temperature);</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="st">            const barWidth = 60;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="st">            const spacing = 30;</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="st">            const x = 60 + i * (barWidth + spacing);</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="st">            // Draw stacked bars</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="st">            let y = canvas.height - 40;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fillStyle = '#FFE5CC';</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="st">            const h1 = sample[0] * 240;</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fillRect(x, y - h1, barWidth, h1);</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fillStyle = '#8B4513';</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="st">            const h2 = sample[1] * 240;</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fillRect(x, y - h1 - h2, barWidth, h2);</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fillStyle = '#FFB6C1';</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="st">            const h3 = sample[2] * 240;</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fillRect(x, y - h1 - h2 - h3, barWidth, h3);</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="st">            // Sample number label</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fillStyle = 'black';</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.textAlign = 'center';</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fillText('Sample ' + (i+1), x + barWidth/2, canvas.height - 20);</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="st">    // Handle slider</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="st">    const slider = document.getElementById('temp-slider');</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="st">    const tempValue = document.getElementById('temp-value');</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="st">    slider.oninput = function() {</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="st">        const temp = parseFloat(this.value);</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="st">        tempValue.textContent = temp.toFixed(2);</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="st">        drawSamples(temp);</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="st">    // Initial draw</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a><span class="st">    drawSamples(1.0);</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="st">})();</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/script&gt;</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>HTML(html_content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div style="background: white; padding: 20px; font-family: Arial;">
    <div style="margin-bottom: 20px; color: black;">
        <label>Temperature: <span id="temp-value">1.0</span></label><br>
        <input type="range" id="temp-slider" min="0.01" max="2.0" step="0.01" value="1.0" style="width: 500px">
    </div>
    <canvas id="gumbel-viz" width="500" height="300" style="border:1px solid #000;"></canvas>
    <div style="color: black; margin-top: 10px;">
        <div style="display: inline-block; margin-right: 20px;">
            <span style="display: inline-block; width: 20px; height: 20px; background: #FFE5CC; margin-right: 5px;"></span>Vanilla
        </div>
        <div style="display: inline-block; margin-right: 20px;">
            <span style="display: inline-block; width: 20px; height: 20px; background: #8B4513; margin-right: 5px;"></span>Chocolate
        </div>
        <div style="display: inline-block;">
            <span style="display: inline-block; width: 20px; height: 20px; background: #FFB6C1; margin-right: 5px;"></span>Strawberry
        </div>
    </div>
</div>

<script>
(function() {
    const canvas = document.getElementById('gumbel-viz');
    const ctx = canvas.getContext('2d');
    
    // Store fixed Gumbel noise samples
    const NUM_SAMPLES = 5;
    const NUM_CLASSES = 3;
    const fixedGumbelNoise = Array(NUM_SAMPLES).fill().map(() => 
        Array(NUM_CLASSES).fill().map(() => -Math.log(-Math.log(Math.random())))
    );
    
    const LOGITS = [2.0, 1.0, 0.0];  // Fixed logits (bias towards vanilla)
    
    function softmax(logits, temperature) {
        const expLogits = logits.map(x => Math.exp(x / temperature));
        const sum = expLogits.reduce((a, b) => a + b, 0);
        return expLogits.map(x => x / sum);
    }

    function generateSample(gumbelNoise, temperature) {
        const noisyLogits = LOGITS.map((l, i) => l + gumbelNoise[i]);
        return softmax(noisyLogits, temperature);
    }

    function drawSamples(temperature) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw axes
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(40, 20);
        ctx.lineTo(40, canvas.height - 40);
        ctx.lineTo(canvas.width - 20, canvas.height - 40);
        ctx.stroke();
        
        // Y-axis labels
        ctx.fillStyle = 'black';
        ctx.font = '12px Arial';
        ctx.textAlign = 'right';
        ctx.fillText('1.0', 35, 25);
        ctx.fillText('0.5', 35, canvas.height/2);
        ctx.fillText('0.0', 35, canvas.height - 35);
        
        // Generate and draw samples using fixed noise
        for(let i = 0; i < NUM_SAMPLES; i++) {
            const sample = generateSample(fixedGumbelNoise[i], temperature);
            const barWidth = 60;
            const spacing = 30;
            const x = 60 + i * (barWidth + spacing);
            
            // Draw stacked bars
            let y = canvas.height - 40;
            ctx.fillStyle = '#FFE5CC';
            const h1 = sample[0] * 240;
            ctx.fillRect(x, y - h1, barWidth, h1);
            
            ctx.fillStyle = '#8B4513';
            const h2 = sample[1] * 240;
            ctx.fillRect(x, y - h1 - h2, barWidth, h2);
            
            ctx.fillStyle = '#FFB6C1';
            const h3 = sample[2] * 240;
            ctx.fillRect(x, y - h1 - h2 - h3, barWidth, h3);
            
            // Sample number label
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            ctx.fillText('Sample ' + (i+1), x + barWidth/2, canvas.height - 20);
        }
    }

    // Handle slider
    const slider = document.getElementById('temp-slider');
    const tempValue = document.getElementById('temp-value');
    slider.oninput = function() {
        const temp = parseFloat(this.value);
        tempValue.textContent = temp.toFixed(2);
        drawSamples(temp);
    }

    // Initial draw
    drawSamples(1.0);
})();
</script>
</div>
</div>
<p><em>Note: Reload the page to get a different random set of probabilities.</em></p>
<p>And as we did in the post <a href="https://drscotthawley.github.io/blog/posts/2021-05-04-the-joy-of-3d.html">“The Joy of 3D”</a>, we can plot the relative class strengths as points in a triangular simplex:</p>
<p><em>Note: the points below are totally different samples from the ones above.</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>html_content <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;div style="background: white; padding: 20px; font-family: Arial;"&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;div style="margin-bottom: 20px; color: black;"&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;label&gt;Temperature: &lt;span id="simplex_temp_value"&gt;1.0&lt;/span&gt;&lt;/label&gt;&lt;br&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;input type="range" id="simplex_temp_slider" min="0.01" max="2.0" step="0.01" value="1.0" style="width: 500px"&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;br&gt;&lt;br&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;label&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;input type="checkbox" id="simplex_rgb_toggle"&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st">            Use RGB coloring</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/label&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;canvas id="simplex_viz" width="500" height="400" style="border:none;"&gt;&lt;/canvas&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;div style="color: black; margin-top: 10px;" id="simplex_legend"&gt;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style="display: inline-block; margin-right: 20px;"&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;span style="display: inline-block; width: 20px; height: 20px; background: #FFE5CC; margin-right: 5px;"&gt;&lt;/span&gt;Vanilla</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style="display: inline-block; margin-right: 20px;"&gt;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;span style="display: inline-block; width: 20px; height: 20px; background: #8B4513; margin-right: 5px;"&gt;&lt;/span&gt;Chocolate</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style="display: inline-block;"&gt;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;span style="display: inline-block; width: 20px; height: 20px; background: #FFB6C1; margin-right: 5px;"&gt;&lt;/span&gt;Strawberry</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/div&gt;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;script&gt;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="st">(function() {</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="st">    const canvas = document.getElementById('simplex_viz');</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="st">    const ctx = canvas.getContext('2d');</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="st">    let useRGB = false;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="st">    // Store fixed Gumbel noise samples</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="st">    const simplex_NUM_SAMPLES = 50;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="st">    const simplex_NUM_CLASSES = 3;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="st">    const simplex_fixedGumbelNoise = Array(simplex_NUM_SAMPLES).fill().map(() =&gt; </span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="st">        Array(simplex_NUM_CLASSES).fill().map(() =&gt; -Math.log(-Math.log(Math.random())))</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="st">    );</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="st">    const simplex_LOGITS = [2.0, 1.0, 0.0];</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="st">    function simplex_softmax(logits, temperature) {</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="st">        const expLogits = logits.map(x =&gt; Math.exp(x / temperature));</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="st">        const sum = expLogits.reduce((a, b) =&gt; a + b, 0);</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="st">        return expLogits.map(x =&gt; x / sum);</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="st">    function simplex_generateSample(gumbelNoise, temperature) {</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="st">        const noisyLogits = simplex_LOGITS.map((l, i) =&gt; l + gumbelNoise[i]);</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="st">        return simplex_softmax(noisyLogits, temperature);</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="st">    function simplex_project(p) {</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="st">        const x = (p[1] - p[2]) * Math.sqrt(3) / 2;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="st">        const y = p[0] - (p[1] + p[2]) / 2;</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="st">        const scale = 200;</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="st">        const centerX = canvas.width / 2;</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="st">        const centerY = canvas.height * 0.6;  // Changed from canvas.height / 2</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="st">        return {</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="st">            x: centerX + x * scale,</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="st">            y: centerY - y * scale</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="st">        };</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="st">    function updateLegend() {</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="st">        const legend = document.getElementById('simplex_legend');</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="st">        if (useRGB) {</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="st">            legend.innerHTML = `</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;div style="display: inline-block; margin-right: 20px;"&gt;</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="st">                    &lt;span style="display: inline-block; width: 20px; height: 20px; background: #FF0000; margin-right: 5px;"&gt;&lt;/span&gt;Vanilla (R)</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;/div&gt;</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;div style="display: inline-block; margin-right: 20px;"&gt;</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="st">                    &lt;span style="display: inline-block; width: 20px; height: 20px; background: #00FF00; margin-right: 5px;"&gt;&lt;/span&gt;Chocolate (G)</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;/div&gt;</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;div style="display: inline-block;"&gt;</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="st">                    &lt;span style="display: inline-block; width: 20px; height: 20px; background: #0000FF; margin-right: 5px;"&gt;&lt;/span&gt;Strawberry (B)</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;/div&gt;</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="st">            `;</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="st">        } else {</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="st">            legend.innerHTML = `</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;div style="display: inline-block; margin-right: 20px;"&gt;</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="st">                    &lt;span style="display: inline-block; width: 20px; height: 20px; background: #FFE5CC; margin-right: 5px;"&gt;&lt;/span&gt;Vanilla</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;/div&gt;</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;div style="display: inline-block; margin-right: 20px;"&gt;</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="st">                    &lt;span style="display: inline-block; width: 20px; height: 20px; background: #8B4513; margin-right: 5px;"&gt;&lt;/span&gt;Chocolate</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;/div&gt;</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;div style="display: inline-block;"&gt;</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a><span class="st">                    &lt;span style="display: inline-block; width: 20px; height: 20px; background: #FFB6C1; margin-right: 5px;"&gt;&lt;/span&gt;Strawberry</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;/div&gt;</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="st">            `;</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="st">    function getPointColor(probs) {</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="st">        if (useRGB) {</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="st">            // RGB coloring - each probability maps directly to a color channel</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="st">            return `rgb(${Math.floor(probs[0] * 255)}, ${Math.floor(probs[1] * 255)}, ${Math.floor(probs[2] * 255)})`;</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="st">        } else {</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="st">            // Original simple pink dots</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="st">            //return 'rgba(255, 0, 0, 0.5)';</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="st">            return 'rgba(0, 0, 0, 0.3)';</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="st">    function simplex_drawSimplex(temperature) {</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.clearRect(0, 0, canvas.width, canvas.height);</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="st">        // Draw triangle outline</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="st">        const corners = [</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="st">            [1, 0, 0],</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="st">            [0, 1, 0],</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="st">            [0, 0, 1]</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="st">        ];</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.beginPath();</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="st">        const first = simplex_project(corners[0]);</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.moveTo(first.x, first.y);</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a><span class="st">        for(let i = 1; i &lt;= 3; i++) {</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a><span class="st">            const p = simplex_project(corners[i % 3]);</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.lineTo(p.x, p.y);</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.strokeStyle = 'black';</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.stroke();</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a><span class="st">        // Label corners</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.fillStyle = 'black';</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.font = '14px Arial';</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.textAlign = 'center';</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="st">        const vanilla = simplex_project([1, 0, 0]);</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a><span class="st">        const chocolate = simplex_project([0, 1, 0]);</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="st">        const strawberry = simplex_project([0, 0, 1]);</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.fillText('Vanilla', vanilla.x, vanilla.y - 20);</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.fillText('Chocolate', chocolate.x + 20, chocolate.y + 30);</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a><span class="st">        ctx.fillText('Strawberry', strawberry.x - 20, strawberry.y + 30);</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="st">        // Draw samples</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a><span class="st">        for(let i = 0; i &lt; simplex_NUM_SAMPLES; i++) {</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a><span class="st">            const probs = simplex_generateSample(simplex_fixedGumbelNoise[i], temperature);</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a><span class="st">            const p = simplex_project(probs);</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.beginPath();</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.arc(p.x, p.y, 4, 0, 2 * Math.PI);  // Slightly larger dots</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fillStyle = getPointColor(probs);</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a><span class="st">            ctx.fill();</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a><span class="st">    // Handle slider</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a><span class="st">    const slider = document.getElementById('simplex_temp_slider');</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a><span class="st">    const tempValue = document.getElementById('simplex_temp_value');</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a><span class="st">    slider.oninput = function() {</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a><span class="st">        const temp = parseFloat(this.value);</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a><span class="st">        tempValue.textContent = temp.toFixed(2);</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a><span class="st">        simplex_drawSimplex(temp);</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a><span class="st">    // Handle RGB toggle</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a><span class="st">    const rgbToggle = document.getElementById('simplex_rgb_toggle');</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a><span class="st">    rgbToggle.onchange = function() {</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a><span class="st">        useRGB = this.checked;</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a><span class="st">        updateLegend();</span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a><span class="st">        simplex_drawSimplex(parseFloat(slider.value));</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a><span class="st">    // Initial draws</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a><span class="st">    updateLegend();</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a><span class="st">    simplex_drawSimplex(1.0);</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a><span class="st">})();</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/script&gt;</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>HTML(html_content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div style="background: white; padding: 20px; font-family: Arial;">
    <div style="margin-bottom: 20px; color: black;">
        <label>Temperature: <span id="simplex_temp_value">1.0</span></label><br>
        <input type="range" id="simplex_temp_slider" min="0.01" max="2.0" step="0.01" value="1.0" style="width: 500px">
        <br><br>
        <label>
            <input type="checkbox" id="simplex_rgb_toggle">
            Use RGB coloring
        </label>
    </div>
    <canvas id="simplex_viz" width="500" height="400" style="border:none;"></canvas>
    <div style="color: black; margin-top: 10px;" id="simplex_legend">
        <div style="display: inline-block; margin-right: 20px;">
            <span style="display: inline-block; width: 20px; height: 20px; background: #FFE5CC; margin-right: 5px;"></span>Vanilla
        </div>
        <div style="display: inline-block; margin-right: 20px;">
            <span style="display: inline-block; width: 20px; height: 20px; background: #8B4513; margin-right: 5px;"></span>Chocolate
        </div>
        <div style="display: inline-block;">
            <span style="display: inline-block; width: 20px; height: 20px; background: #FFB6C1; margin-right: 5px;"></span>Strawberry
        </div>
    </div>
</div>

<script>
(function() {
    const canvas = document.getElementById('simplex_viz');
    const ctx = canvas.getContext('2d');
    let useRGB = false;
    
    // Store fixed Gumbel noise samples
    const simplex_NUM_SAMPLES = 50;
    const simplex_NUM_CLASSES = 3;
    const simplex_fixedGumbelNoise = Array(simplex_NUM_SAMPLES).fill().map(() => 
        Array(simplex_NUM_CLASSES).fill().map(() => -Math.log(-Math.log(Math.random())))
    );
    
    const simplex_LOGITS = [2.0, 1.0, 0.0];
    
    function simplex_softmax(logits, temperature) {
        const expLogits = logits.map(x => Math.exp(x / temperature));
        const sum = expLogits.reduce((a, b) => a + b, 0);
        return expLogits.map(x => x / sum);
    }

    function simplex_generateSample(gumbelNoise, temperature) {
        const noisyLogits = simplex_LOGITS.map((l, i) => l + gumbelNoise[i]);
        return simplex_softmax(noisyLogits, temperature);
    }

    function simplex_project(p) {
        const x = (p[1] - p[2]) * Math.sqrt(3) / 2;
        const y = p[0] - (p[1] + p[2]) / 2;
        
        const scale = 200;
        const centerX = canvas.width / 2;
        const centerY = canvas.height * 0.6;  // Changed from canvas.height / 2
        
        return {
            x: centerX + x * scale,
            y: centerY - y * scale
        };
    }

    function updateLegend() {
        const legend = document.getElementById('simplex_legend');
        if (useRGB) {
            legend.innerHTML = `
                <div style="display: inline-block; margin-right: 20px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: #FF0000; margin-right: 5px;"></span>Vanilla (R)
                </div>
                <div style="display: inline-block; margin-right: 20px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: #00FF00; margin-right: 5px;"></span>Chocolate (G)
                </div>
                <div style="display: inline-block;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: #0000FF; margin-right: 5px;"></span>Strawberry (B)
                </div>
            `;
        } else {
            legend.innerHTML = `
                <div style="display: inline-block; margin-right: 20px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: #FFE5CC; margin-right: 5px;"></span>Vanilla
                </div>
                <div style="display: inline-block; margin-right: 20px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: #8B4513; margin-right: 5px;"></span>Chocolate
                </div>
                <div style="display: inline-block;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: #FFB6C1; margin-right: 5px;"></span>Strawberry
                </div>
            `;
        }
    }

    function getPointColor(probs) {
        if (useRGB) {
            // RGB coloring - each probability maps directly to a color channel
            return `rgb(${Math.floor(probs[0] * 255)}, ${Math.floor(probs[1] * 255)}, ${Math.floor(probs[2] * 255)})`;
        } else {
            // Original simple pink dots
            //return 'rgba(255, 0, 0, 0.5)';
            return 'rgba(0, 0, 0, 0.3)';
        }
    }

    function simplex_drawSimplex(temperature) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw triangle outline
        const corners = [
            [1, 0, 0],
            [0, 1, 0],
            [0, 0, 1]
        ];
        
        ctx.beginPath();
        const first = simplex_project(corners[0]);
        ctx.moveTo(first.x, first.y);
        for(let i = 1; i <= 3; i++) {
            const p = simplex_project(corners[i % 3]);
            ctx.lineTo(p.x, p.y);
        }
        ctx.strokeStyle = 'black';
        ctx.stroke();
        
        // Label corners
        ctx.fillStyle = 'black';
        ctx.font = '14px Arial';
        ctx.textAlign = 'center';
        const vanilla = simplex_project([1, 0, 0]);
        const chocolate = simplex_project([0, 1, 0]);
        const strawberry = simplex_project([0, 0, 1]);
        ctx.fillText('Vanilla', vanilla.x, vanilla.y - 20);
        ctx.fillText('Chocolate', chocolate.x + 20, chocolate.y + 30);
        ctx.fillText('Strawberry', strawberry.x - 20, strawberry.y + 30);
        
        // Draw samples
        for(let i = 0; i < simplex_NUM_SAMPLES; i++) {
            const probs = simplex_generateSample(simplex_fixedGumbelNoise[i], temperature);
            const p = simplex_project(probs);
            
            ctx.beginPath();
            ctx.arc(p.x, p.y, 4, 0, 2 * Math.PI);  // Slightly larger dots
            ctx.fillStyle = getPointColor(probs);
            ctx.fill();
        }
    }

    // Handle slider
    const slider = document.getElementById('simplex_temp_slider');
    const tempValue = document.getElementById('simplex_temp_value');
    slider.oninput = function() {
        const temp = parseFloat(this.value);
        tempValue.textContent = temp.toFixed(2);
        simplex_drawSimplex(temp);
    }

    // Handle RGB toggle
    const rgbToggle = document.getElementById('simplex_rgb_toggle');
    rgbToggle.onchange = function() {
        useRGB = this.checked;
        updateLegend();
        simplex_drawSimplex(parseFloat(slider.value));
    }

    // Initial draws
    updateLegend();
    simplex_drawSimplex(1.0);
})();
</script>
</div>
</div>
<p>Let’s break this down into sections:</p>
</section>
<section id="the-problem-discrete-vs.-continuous" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="the-problem-discrete-vs.-continuous"><span class="header-section-number">1.2</span> 1. The Problem: Discrete vs.&nbsp;Continuous</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's say we want to output one of these choices:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>choices <span class="op">=</span> [<span class="st">'vanilla'</span>, <span class="st">'chocolate'</span>, <span class="st">'strawberry'</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># In one-hot encoding this would be like:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>vanilla   <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>chocolate <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>strawberry <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-challenge-of-discrete-outputs" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="the-challenge-of-discrete-outputs"><span class="header-section-number">1.3</span> 2. The Challenge of Discrete Outputs</h2>
<p>If we use normal softmax, we get probabilities:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> softmax(logits):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    exp_logits <span class="op">=</span> torch.exp(logits)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> exp_logits <span class="op">/</span> exp_logits.<span class="bu">sum</span>()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Example output:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>probs <span class="op">=</span> [<span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.1</span>]  <span class="co"># Continuous numbers. In this case, chocolate should "win"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>probs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[0.3, 0.6, 0.1]</code></pre>
</div>
</div>
<p>But we need a discrete choice. We could take argmax, but argmax isn’t differentiable!</p>
</section>
<section id="the-gumbel-max-trick" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="the-gumbel-max-trick"><span class="header-section-number">1.4</span> 3. The Gumbel-Max Trick</h2>
<p>First, let’s understand a clever way to sample from a discrete distribution called the Gumbel-Max trick:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sample_gumbel(shape):</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Draw samples from Gumbel(0, 1)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> torch.rand(shape)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>torch.log(<span class="op">-</span>torch.log(U))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gumbel_max_sample(logits):</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add Gumbel noise to logits</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    gumbel_noise <span class="op">=</span> sample_gumbel(logits.shape)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Take argmax - this gives a discrete sample</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.argmax(logits <span class="op">+</span> gumbel_noise)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Example:</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>logits <span class="op">=</span> torch.tensor([<span class="fl">2.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>])  <span class="co"># preference for vanilla</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> [gumbel_max_sample(logits) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The amazing thing about the Gumbel-Max trick is that it converts our deterministic logits into random samples that follow the same probability distribution we’d get from softmax! But it’s still not differentiable because of the argmax.</p>
</section>
<section id="enter-gumbel-softmax" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="enter-gumbel-softmax"><span class="header-section-number">1.5</span> 4. Enter Gumbel-Softmax</h2>
<p>Here’s where the magic happens. Instead of argmax, we use softmax with a temperature parameter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gumbel_softmax(logits, temperature<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    gumbel_noise <span class="op">=</span> sample_gumbel(logits.shape)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Instead of argmax, use softmax:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> torch.softmax((logits <span class="op">+</span> gumbel_noise) <span class="op">/</span> temperature, dim<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>logits <span class="op">=</span> torch.tensor([<span class="fl">2.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># High temperature -&gt; more uniform</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gumbel_softmax(logits, temperature<span class="op">=</span><span class="fl">1.0</span>))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Low temperature -&gt; closer to one-hot</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gumbel_softmax(logits, temperature<span class="op">=</span><span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor([0.2416, 0.4141, 0.3443])
tensor([1.3775e-05, 9.9999e-01, 1.3909e-19])</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Question: So the Gumbel-Softmax trick is just to replace argmax with sofmax using a very low temperatue?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question: So the Gumbel-Softmax trick is just to replace argmax with sofmax using a very low temperatue?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Not quite! The key parts are:</p>
<ol type="1">
<li>The Gumbel noise is crucial - it’s what enables proper sampling from the distribution The temperature parameter controls how “discrete” we want our output to be.</li>
<li>Without the Gumbel noise, using a low-temperature softmax would just make the largest logit even larger. But with Gumbel noise, we get:</li>
</ol>
</div>
</div>
<p>The Gumbel noise ensures we get proper random samples from our desired categorical distribution, while the softmax+temperature gives us a differentiable approximation of argmax. When temperature approaches 0, it becomes closer to true one-hot samples, while higher temperatures make it more continuous. This is why it’s useful for training - we can start with higher temperatures for better gradients, then anneal the temperature down to get more discrete outputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regular_softmax(logits, temperature<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.softmax(logits <span class="op">/</span> temperature, dim<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gumbel_softmax(logits, temperature<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    gumbel_noise <span class="op">=</span> sample_gumbel(logits.shape)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.softmax((logits <span class="op">+</span> gumbel_noise) <span class="op">/</span> temperature, dim<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's compare:</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>logits <span class="op">=</span> torch.tensor([<span class="fl">2.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>])</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Regular low-temp softmax:"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(regular_softmax(logits, temperature<span class="op">=</span><span class="fl">0.1</span>))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Always gives same deterministic output</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Gumbel-softmax:"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(gumbel_softmax(logits, temperature<span class="op">=</span><span class="fl">0.1</span>))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Gives different samples each time</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Regular low-temp softmax:
tensor([9.9995e-01, 4.5398e-05, 2.0611e-09])
tensor([9.9995e-01, 4.5398e-05, 2.0611e-09])
tensor([9.9995e-01, 4.5398e-05, 2.0611e-09])

Gumbel-softmax:
tensor([1.0000e+00, 1.5321e-11, 3.0799e-12])
tensor([8.1052e-01, 1.8948e-01, 6.8012e-13])
tensor([0.0033, 0.2463, 0.7504])</code></pre>
</div>
</div>
<p>The Gumbel noise ensures we get proper random samples from our desired categorical distribution, while the softmax+temperature gives us a differentiable approximation of argmax. When temperature approaches 0, it becomes closer to true one-hot samples, while higher temperatures make it more continuous.</p>
<p>This is why it’s useful for training - we can start with higher temperatures for better gradients, then anneal the temperature down to get more discrete outputs.</p>
<p>let’s look at this from a 3d standpoint as well:</p>
<hr>
</section>
</section>
<section id="references" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> References</h1>
<div id="refs" role="list">

</div>
<hr>
<ol start="3" type="a">
<li>2024 Scott H. Hawley</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode bibtex code-with-copy"><code class="sourceCode bibtex"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="va">@misc</span>{<span class="ot">hawley2024gumbel</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span>={Learning Discrete Variables Continuously via Gumbel-Softmax}, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">author</span>={Scott H. Hawley},</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">year</span>={2024},</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">url</span>={https://drscotthawley.github.io/blog/posts/GumbelSoftmax.html}</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="acknowledgement" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="acknowledgement">Acknowledgement</h4>
<p>Much of this was produced in concert with Claude 3.5 Sonnet.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/drscotthawley\.github\.io\/blog");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>